FROM ubuntu:trusty
LABEL maintainer="Boik Su <boik@tdohacker.org>"

ENV HOME /root/fbctf

ARG DOMAIN
ARG EMAIL
ARG MODE=dev
ARG TYPE=self
ARG KEY
ARG CRT

#WORKDIR $HOME
#COPY . $HOME
RUN apt-get update \
  && apt-get install -y \
  rsync \
  git \
  curl \
  ca-certificates \
  && git clone https://github.com/facebook/fbctf $HOME \
  && cd $HOME \
  && chown www-data:www-data $HOME \
  && ./extra/provision.sh -m $MODE -c $TYPE -k $KEY -C $CRT -D $DOMAIN -e $EMAIL -s `pwd` --docker \
  && rm -f /var/run/hhvm/sock \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*
CMD ["/root/fbctf/extra/service_startup.sh"]
